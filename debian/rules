#!/usr/bin/make -f

pkgs := slind-core slind-maintainer-core
dir_slind-core := debian/slind-core
dir_slind-maintainer-core := debian/slind-maintainer-core
dirs := $(dir_slind-core) $(dir_slind-maintainer-core)

configure:
	dh_testdir

clean:
	dh_testdir
	#$(MAKE) clean

	rm -f debian/substvars build-stamp debian/files
	rm -rf $(dirs)

build: build-stamp configure
build-stamp:
	#$(MAKE)
	touch $@

install: build
	dh_testdir
	dh_testroot

	dh_clean -k
	dh_installdirs

binary-arch: install
	dh_testdir
	dh_testroot

	# slind-core
	mkdir -p $(dir_slind-core)/usr/bin
	mkdir -p $(dir_slind-core)/etc/slind
	cp slindctl $(dir_slind-core)/usr/bin
	cp slind-config $(dir_slind-core)/etc/slind

	# slind-maintainer-core
	mkdir -p $(dir_slind-maintainer-core)/usr/bin
	mkdir -p $(dir_slind-maintainer-core)/etc
	mkdir -p $(dir_slind-maintainer-core)/var/lib/slind-maint
	cp poolcare $(dir_slind-maintainer-core)/usr/bin
	cp slindjob $(dir_slind-maintainer-core)/usr/bin
	cp slindjob-config $(dir_slind-maintainer-core)/etc
	cp *.pkglist $(dir_slind-maintainer-core)/var/lib/slind-maint
	dh_installchangelogs
	
	dh_installdeb
	dh_gencontrol
	dh_md5sums
	dh_builddeb
	
binary: binary-arch

.PHONY: configure clean build install binary-arch binary
